{% extends 'base.html' %}

{% block content %}
<div class="container py-5">
  <h2 class="mb-4">Admin Dashboard</h2>

  <p class="text-muted">
    Welcome, Admin! Manage your products, hero banner, logo, background,
    orders, categories, coupons, delivery fee, Know Your Perfume guide,
    and the Top Banner announcement.
  </p>

    <!-- âœ… Sales Snapshot -->
  <div class="row mb-5">
    <div class="col-md-4 mb-3">
      <div class="card text-center shadow-sm rounded-3">
        <div class="card-body">
          <h6 class="card-title fw-semibold">Total Orders This Month</h6>
          <h3 class="mb-0">{{ total_orders }}</h3>
        </div>
      </div>
    </div>

    <div class="col-md-4 mb-3">
      <div class="card text-center shadow-sm rounded-3">
        <div class="card-body">
          <h6 class="card-title fw-semibold">Revenue This Month</h6>
          <h3 class="mb-0">PKR {{ '%.2f'|format(total_revenue) }}</h3>
        </div>
      </div>
    </div>

    <div class="col-md-4 mb-3">
      <div class="card text-center shadow-sm rounded-3">
        <div class="card-body">
          <h6 class="card-title fw-semibold">Top-Selling Scents</h6>
          {% if top_products %}
            <ul class="list-group list-group-flush text-start">
              {% for product in top_products %}
                <li class="list-group-item d-flex justify-content-between">
                  {{ product.name }}
                  <span class="badge bg-dark">{{ product.total_sold }}</span>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted mb-0">No sales yet this month.</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- âœ… Quick Actions -->
  <div class="mb-4 d-flex flex-wrap gap-2">
    <a href="{{ url_for('admin_orders') }}" class="btn btn-outline-primary">
      ðŸ“¦ View All Orders
    </a>
    <a href="{{ url_for('admin_categories') }}" class="btn btn-outline-secondary">
      ðŸ“‚ Manage Categories
    </a>
  </div>

  <!-- âœ… Add New Product -->
  <div class="card p-4 mb-5 shadow rounded-3">
    <h4 class="mb-3">Add New Product</h4>
    <form method="POST" enctype="multipart/form-data" action="{{ url_for('add_product') }}">
      <div class="mb-3">
        <label class="form-label">Name</label>
        <input type="text" name="name" class="form-control" placeholder="Enter product name" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Description</label>
        <textarea name="description" class="form-control" placeholder="Enter product description" required></textarea>
      </div>
      <div class="mb-3">
        <label class="form-label">Price (PKR)</label>
        <input type="number" step="0.01" name="price" class="form-control" placeholder="e.g. 2500.00" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Category</label>
        <select name="category_id" class="form-select" required>
          <option value="">-- Select Category --</option>
          {% for cat in categories %}
            <option value="{{ cat.id }}">{{ cat.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="mb-3">
        <label class="form-label">Product Image</label>
        <input type="file" name="image" class="form-control" required>
      </div>
      <button type="submit" class="btn btn-success">Add Product</button>
    </form>
  </div>

  <!-- âœ… Product List -->
  <h4 class="mb-3">All Products</h4>
  <div class="table-responsive mb-5">
    <table class="table table-bordered table-striped align-middle">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Price</th>
          <th>Image</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for product in products %}
        <tr>
          <td>{{ product.id }}</td>
          <td>{{ product.name }}</td>
          <td>PKR {{ '%.2f'|format(product.price) }}</td>
          <td>
            <img src="{{ url_for('static', filename='uploads/' ~ product.image) }}"
                 alt="{{ product.name }}"
                 width="60" class="rounded shadow-sm">
          </td>
          <td>
            <a href="{{ url_for('delete_product', product_id=product.id) }}"
               class="btn btn-sm btn-danger"
               onclick="return confirm('Are you sure you want to delete this product?');">
              Delete
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- âœ… Coupon Management -->
  <div class="card p-4 mb-5 shadow rounded-3">
    <h4 class="mb-3">Add Coupon</h4>
    <form method="POST" action="{{ url_for('add_coupon') }}">
      <div class="mb-3">
        <label class="form-label">Coupon Code</label>
        <input type="text" name="code" class="form-control" placeholder="e.g. SUMMER20" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Discount</label>
        <input type="number" step="0.01" name="discount" class="form-control" placeholder="e.g. 20 for 20%" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Type</label>
        <select name="type" class="form-select" required>
          <option value="percentage">Percentage</option>
          <option value="fixed">Fixed Amount</option>
          <option value="free_delivery">Free Delivery</option>
        </select>
      </div>
      <div class="mb-3">
        <label class="form-label">Description (optional)</label>
        <textarea name="description" class="form-control"></textarea>
      </div>
      <button type="submit" class="btn btn-warning">Add Coupon</button>
    </form>
  </div>

  <!-- âœ… Spin Wheel Feature Toggle -->
  <div class="card p-4 mb-5 shadow rounded-3">
    <h4 class="mb-3">Spin Wheel Feature</h4>
    <form method="POST" action="{{ url_for('toggle_spin_wheel') }}">
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="spinSwitch" name="enabled"
               {% if spin_enabled %}checked{% endif %}>
        <label class="form-check-label" for="spinSwitch">
          Enable Spin Wheel Discount for Customers
        </label>
      </div>
      <button type="submit" class="btn btn-dark mt-3">
        {% if spin_enabled %}Disable{% else %}Enable{% endif %} Spin Wheel
      </button>
    </form>
    {% if spin_enabled %}
      <p class="text-success mt-2 fw-semibold">Spin Wheel is currently <strong>Enabled</strong>.</p>
    {% else %}
      <p class="text-danger mt-2 fw-semibold">Spin Wheel is currently <strong>Disabled</strong>.</p>
    {% endif %}
  </div>

  <!-- âœ… Delivery Fee -->
  <div class="card p-4 mb-5 shadow rounded-3">
    <h4 class="mb-3">Set Delivery Fee</h4>
    <form method="POST" action="{{ url_for('update_delivery_fee') }}">
      <div class="mb-3">
        <label class="form-label">Delivery Fee (PKR)</label>
        <input type="number" step="0.01" name="delivery_fee" class="form-control"
               value="{{ delivery_fee if delivery_fee is defined else '' }}"
               placeholder="e.g. 250">
      </div>
      <button type="submit" class="btn btn-dark">Update Delivery Fee</button>
    </form>
    {% if delivery_fee %}
      <p class="mt-2 text-success fw-semibold">Current Delivery Fee: PKR {{ delivery_fee }}</p>
    {% endif %}
  </div>

  <!-- âœ… Upload Hero Banner -->
  <div class="card p-4 mb-5 shadow rounded-3">
    <h4 class="mb-3">Upload Hero Banner</h4>
    <form method="POST" enctype="multipart/form-data" action="{{ url_for('upload_banner') }}">
      <div class="mb-3">
        <label class="form-label">Banner Image</label>
        <input type="file" name="banner" class="form-control">
      </div>
      <div class="mb-3">
        <label class="form-label">Banner Video (MP4)</label>
        <input type="file" name="banner_video" class="form-control">
      </div>
      <button type="submit" class="btn btn-primary">Upload Banner</button>
    </form>
    {% if banner and banner.filename %}
      <p class="mt-3 fw-semibold">Current Banner Image:</p>
      <img src="{{ url_for('static', filename='uploads/banners/' ~ banner.filename) }}" class="img-fluid rounded shadow">
    {% endif %}
    {% if banner and banner.video %}
      <p class="mt-3 fw-semibold">Current Banner Video:</p>
      <video src="{{ url_for('static', filename='uploads/banners/' ~ banner.video) }}"
             autoplay muted loop controls class="img-fluid rounded shadow"></video>
    {% endif %}
  </div>

  <!-- âœ… Upload Shop Logo -->
  <div class="card p-4 mb-5 shadow rounded-3">
    <h4 class="mb-3">Upload Shop Logo</h4>
    <form method="POST" enctype="multipart/form-data" action="{{ url_for('upload_logo') }}">
      <div class="mb-3">
        <label class="form-label">Logo Image</label>
        <input type="file" name="logo" class="form-control" required>
      </div>
      <button type="submit" class="btn btn-info">Upload Logo</button>
    </form>
    {% if logo %}
      <p class="mt-3 fw-semibold">Current Logo:</p>
      <img src="{{ url_for('static', filename='uploads/logos/' ~ logo.filename) }}"
           class="img-fluid rounded shadow" style="max-height: 100px;">
    {% endif %}
  </div>

  <!-- âœ… Know Your Perfume Upload -->
  <div class="card p-4 mb-5 shadow rounded-3">
    <h4 class="mb-3">Upload "Know Your Perfume" Guide Image</h4>
    <form method="POST" enctype="multipart/form-data" action="{{ url_for('upload_know_your_perfume') }}">
      <div class="mb-3">
        <label class="form-label">Upload Image</label>
        <input type="file" name="know_your_perfume_image" class="form-control" required>
      </div>
      <button type="submit" class="btn btn-primary">Upload Image</button>
    </form>
    {% if know_your_perfume %}
      <p class="mt-3 fw-semibold">Current Guide Image:</p>
      <img src="{{ url_for('static', filename='uploads/' ~ know_your_perfume.filename) }}"
           class="img-fluid rounded shadow">
    {% endif %}
  </div>

  <!-- âœ… Top Banner Announcement -->
  <div class="card p-4 mb-4 shadow rounded-3">
    <h4 class="mb-3">Update Top Banner Text</h4>
    <form method="POST" action="{{ url_for('update_top_banner') }}">
      <div class="mb-3">
        <label class="form-label">Banner Text</label>
        <textarea name="banner_text" rows="2" class="form-control" required>{{ top_banner }}</textarea>
      </div>
      <button type="submit" class="btn btn-primary">Update Banner</button>
    </form>
  </div>

  <!-- âœ… Upload Background -->
  <div class="card p-4 mb-4 shadow rounded-3">
    <h4 class="mb-3">Upload Background Theme</h4>
    <form method="POST" enctype="multipart/form-data" action="{{ url_for('upload_background') }}">
      <div class="mb-3">
        <label class="form-label">Background Image</label>
        <input type="file" name="background" class="form-control" required>
      </div>
      <button type="submit" class="btn btn-secondary">Upload Background</button>
    </form>
    {% if background %}
      <p class="mt-3 fw-semibold">Current Background:</p>
      <img src="{{ url_for('static', filename='uploads/backgrounds/' ~ background.filename) }}"
           class="img-fluid rounded shadow">
    {% endif %}
  </div>
</div>

<!-- âœ… Optional: Card hover effect -->
<style>
  .card:hover {
    transform: translateY(-3px);
    transition: transform 0.3s ease;
  }
</style>
{% endblock %}
